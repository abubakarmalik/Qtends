### ENV
@baseUrl = http://localhost:5000

# Token comes from the Login response (run Login first, then this will populate)
@token = {{login.response.body.$.token}}

################################################################################
# HEALTH
################################################################################

### Health (public)
GET {{baseUrl}}/health

################################################################################
# AUTH
################################################################################

### Register (public)
# @name register
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "name": "Umar",
  "email": "umar@test.com",
  "password": "secret123"
}

### (Manual) Make this user admin in Mongo shell (run once):
# mongosh
# use mern_shop
# db.users.updateOne({ email: "umar@test.com" }, { $set: { role: "admin" } })

### Login (public) — token will be available as {{login.response.body.$.token}}
# @name login
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "umar@test.com",
  "password": "secret123"
}

################################################################################
# CATEGORIES (top-level and subcategories)
################################################################################

### Create Category (admin) — Electronics (auto-slug)
# @name cat_create_electronics
POST {{baseUrl}}/api/categories
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Electronics"
}

### Create Category (admin) — Clothing (auto-slug)
# @name cat_create_clothing
POST {{baseUrl}}/api/categories
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Clothing"
}

### Create Subcategory (admin) — Mobiles under Electronics
# @name subcat_mobiles
POST {{baseUrl}}/api/categories
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Mobiles",
  "parentSlug": "electronics"
}

### Create Subcategory (admin) — Laptops under Electronics
# @name subcat_laptops
POST {{baseUrl}}/api/categories
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "mobiles",
  "parentSlug": "electronics"
}

### List Categories (public)
GET {{baseUrl}}/api/categories

### Category: Electronics (public)
GET {{baseUrl}}/api/categories/electronics

### List Subcategories of Electronics (public)
GET {{baseUrl}}/api/categories/electronics/subcategories

### Tree (public)
GET {{baseUrl}}/api/categories/tree

### Update Category (admin) — rename Electronics (slug stays same by default)
PATCH {{baseUrl}}/api/categories/electronics
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Electronics & Gadgets"
}

### (Option) Update Category & regenerate slug from new name
PATCH {{baseUrl}}/api/categories/electronics
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Consumer Electronics",
  "regenerateSlug": true
}

### Delete Category (admin) — Clothing (soft delete)
DELETE {{baseUrl}}/api/categories/smartphones
Authorization: Bearer {{token}}

################################################################################
# PRODUCTS (with category/subcategory + auto-slug)
################################################################################

# We’ll capture slugs from create responses so you don’t have to copy/paste.
# After running the create requests below, these variables will resolve:
@iphoneSlug = {{prod_create_iphone.response.body.$.item.slug}}
@ultraSlug  = {{prod_create_ultra.response.body.$.item.slug}}

### Create Product (admin) — iPhone 15 Pro (Electronics → Mobiles)
# Uses {{$timestamp}} so repeated runs don’t collide on slug
# @name prod_create_iphone
POST {{baseUrl}}/api/products
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "Apple iPhone 15 Pro {{$timestamp}}",
  "price": 1299.99,
  "stock": 25,
  "images": ["https://example.com/images/iphone15.jpg"],
  "categorySlug": "electronics",
  "subcategorySlug": "mobiles-3"
}

### Create Product (admin) — Adidas Ultraboost (no category set)
# @name prod_create_ultra
POST {{baseUrl}}/api/products
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "Adidas Ultraboost 22 {{$timestamp}}",
  "price": 179.99,
  "stock": 50,
  "images": ["https://example.com/images/ultraboost22.jpg"]
}

### List Products (public)
GET {{baseUrl}}/api/products

### Filter by Category (public) — Electronics
GET {{baseUrl}}/api/products?category=electronics

### Filter by Subcategory (public) — Mobiles
GET {{baseUrl}}/api/products?subcategory=smartphones

### Get Single Product (public) — iPhone (captured slug)
GET {{baseUrl}}/api/products/{{iphoneSlug}}

### Update Product (admin) — change title & regenerate slug (iPhone)
PATCH {{baseUrl}}/api/products/{{iphoneSlug}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "Apple iPhone 15 Pro Max {{$timestamp}}",
  "regenerateSlug": true
}

### Move Product into a different subcategory (admin) — set to laptops
PATCH {{baseUrl}}/api/products/{{iphoneSlug}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "categorySlug": "electronics",
  "subcategorySlug": "laptops"
}

### Delete Product (admin) — soft delete (Ultraboost)
DELETE {{baseUrl}}/api/products/{{ultraSlug}}
Authorization: Bearer {{token}}

################################################################################
################################################################################
# CART (auth required)
################################################################################

### Get My Cart
GET {{baseUrl}}/api/cart
Authorization: Bearer {{token}}

### Add Item — iPhone (from earlier)
POST {{baseUrl}}/api/cart/items
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "productSlug": "{{iphoneSlug}}",
  "qty": 2
}

### Update Item Qty — iPhone → 3
PATCH {{baseUrl}}/api/cart/items/{{iphoneSlug}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "qty": 1
}

### Remove Item — iPhone
DELETE {{baseUrl}}/api/cart/items/{{iphoneSlug}}
Authorization: Bearer {{token}}

### Clear Cart
DELETE {{baseUrl}}/api/cart
Authorization: Bearer {{token}}

################################################################################
# ORDERS / CHECKOUT
################################################################################

# Address template you can reuse
@fullName = Umar
@phone = 03001234567
@address1 = 221B Baker Street
@address2 =
@city = Karachi
@state = Sindh
@postalCode = 74200
@country = PK

### Get My Cart (ensure it has items)
GET {{baseUrl}}/api/cart
Authorization: Bearer {{token}}

### Add one more iPhone to cart (if needed)
POST {{baseUrl}}/api/cart/items
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "productSlug": "{{iphoneSlug}}",
  "qty": 1
}

### Create Order from Cart (auth)
# @name create_order
POST {{baseUrl}}/api/orders
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "shippingAddress": {
    "fullName": "{{fullName}}",
    "phone": "{{phone}}",
    "address1": "{{address1}}",
    "address2": "{{address2}}",
    "city": "{{city}}",
    "state": "{{state}}",
    "postalCode": "{{postalCode}}",
    "country": "{{country}}"
  },
  "paymentMethod": "cod"
}

# capture order id for later
@orderId = {{create_order.response.body.$.order._id}}

### My Orders (auth)
GET {{baseUrl}}/api/orders
Authorization: Bearer {{token}}

### Get Order by ID (auth — owner or admin)
GET {{baseUrl}}/api/orders/{{orderId}}
Authorization: Bearer {{token}}

### Cancel My Order (auth) — only if pending + unpaid
DELETE {{baseUrl}}/api/orders/{{orderId}}
Authorization: Bearer {{token}}

### ADMIN — List All Orders
GET {{baseUrl}}/api/orders/admin/all
Authorization: Bearer {{token}}

### ADMIN — Mark Order Paid
PATCH {{baseUrl}}/api/orders/{{orderId}}/status
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "paymentStatus": "paid",
  "status": "paid"
}

### ADMIN — Mark Order Shipped
PATCH {{baseUrl}}/api/orders/{{orderId}}/status
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "status": "shipped"
}

### ADMIN — Mark Order Delivered
PATCH {{baseUrl}}/api/orders/{{orderId}}/status
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "status": "delivered"
}

